<!DOCTYPE html>
<html lang="ko" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>배터리 충전 정보 계산기</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" data-bs-theme="dark">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        .error {
            font-size: 0.8em;
            margin-top: 0.25rem;
        }
        .input-group {
            flex-wrap: nowrap;
        }
        .input-group .form-control {
            min-width: 70px;
            flex: 1 1 auto;
        }
        .input-group .input-group-text {
            white-space: nowrap;
        }
        .equals-separator {
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--bs-secondary-color);
            font-weight: bold;
            padding: 0 0.25rem;
        }
        .result-section { }
        .result-item {
            padding: 0.5rem;
        }
        .result-header {
            font-size: 0.9rem;
            color: var(--bs-secondary-color);
            margin-bottom: 0.25rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
            line-height: 1.2;
        }
        .result-value {
            min-height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            word-break: keep-all;
            overflow-wrap: break-word;
        }
        .progress {
            height: 1.5rem;
        }
        @media (max-width: 400px) {
            .result-header {
                font-size: 0.8rem;
            }
            .result-value {
                font-size: 1.1rem;
                min-height: 2rem;
            }
            .result-item {
                padding: 0.25rem;
            }
            .container.result-section.p-3 {
                padding: 0.5rem !important;
            }
            .input-group .form-control {
                min-width: 55px;
            }
        }
        @media (max-width: 576px) {
            .row > [class^="col-"].mb-3 .row.g-2 { margin-bottom: 0.5rem; }
            .row > [class^="col-"].mb-3 .row.g-2:last-child { margin-bottom: 0; }
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <div class="mb-4 text-center">
            <h1><i class="bi bi-ev-station-fill me-2"></i>배터리 충전 정보</h1>
        </div>

        <div class="mb-4 p-3 border rounded shadow-sm bg-body-tertiary result-section">
            <h5 class="text-center mb-3 border-bottom pb-2">
                <i class="bi bi-check-circle-fill me-2 text-success"></i>예상 결과
            </h5>
            <div class="row text-center result-grid g-3">
                <div class="col result-item">
                    <div class="result-header">
                        <i class="bi bi-hourglass-split me-1"></i> 소요시간
                    </div>
                    <div class="result-value fs-5 fw-medium" id="estimatedTime">-</div>
                </div>
                <div class="col result-item border-start border-end">
                    <div class="result-header">
                        <i class="bi bi scores/score_0.json
calendar-check me-1"></i> 완료시간
                    </div>
                    <div class="result-value fs-5 fw-medium" id="endTime">-</div>
                </div>
                <div class="col result-item">
                    <div class="result-header">
                        <i class="bi bi-clock-history me-1"></i> 남은시간
                    </div>
                    <div class="result-value fs-5 fw-medium" id="remainingUntilEndTime">-</div>
                </div>
            </div>
            <div class="progress mt-3">
                <div class="progress-bar bg-success" role="progressbar" style="width: 0%;" id="chargeProgress" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
        </div>

        <div class="card mb-4 shadow-sm">
            <div class="card-header">
                <h5><i class="bi bi-battery-half me-2"></i>배터리 정보</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="batteryCapacity" class="form-label">배터리 총 용량 :</label>
                    <div class="input-group">
                        <input type="number" class="form-control" id="batteryCapacity" min="0" step="0.01" value="84" required aria-label="배터리 총 용량 (kWh)">
                        <span class="input-group-text">kWh</span>
                    </div>
                    <div id="batteryCapacityError" class="error text-danger" aria-live="polite"></div>
                </div>
                <div class="mb-3">
                    <label class="form-label">현재 배터리 :</label>
                    <div class="row g-2 align-items-center">
                        <div class="col"><div class="input-group"><input type="number" class="form-control" id="remainPercent" min="0" max="100" step="0.01" value="30" required aria-label="현재 배터리 (%)"><span class="input-group-text">%</span></div></div>
                        <div class="col-auto"><span class="equals-separator">=</span></div>
                        <div class="col"><div class="input-group"><input type="number" class="form-control" id="remainKWh" min="0" step="0.01" required aria-label="현재 배터리 (kWh)"><span class="input-group-text">kWh</span></div></div>
                    </div>
                    <div id="remainError" class="error text-danger mt-1" aria-live="polite"></div>
                </div>
                <div class="mb-3">
                    <label class="form-label">충전 목표 :</label>
                    <div class="row g-2 align-items-center">
                        <div class="col"><div class="input-group"><input type="number" class="form-control" id="targetPercent" min="0" max="100" step="0.01" value="100" required aria-label="충전 목표 (%)"><span class="input-group-text">%</span></div></div>
                        <div class="col-auto"><span class="equals-separator">=</span></div>
                        <div class="col"><div class="input-group"><input type="number" class="form-control" id="targetKWh" min="0" step="0.01" required aria-label="충전 목표 (kWh)"><span class="input-group-text">kWh</span></div></div>
                    </div>
                    <div id="targetError" class="error text-danger mt-1" aria-live="polite"></div>
                </div>
            </div>
        </div>

        <div class="card mb-4 shadow-sm">
            <div class="card-header">
                <h5><i class="bi bi-speedometer2 me-2"></i>충전 설정</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="chargeSpeed" class="form-label">충전 속도 :</label>
                    <div class="input-group">
                        <input type="number" class="form-control" id="chargeSpeed" min="0" step="0.01" value="7" required aria-label="충전 속도 (kW)">
                        <span class="input-group-text">kW</span>
                    </div>
                    <div id="chargeSpeedError" class="error text-danger" aria-live="polite"></div>
                </div>
                <div class="mb-3">
                    <label for="efficiency" class="form-label">충전 효율 (%) :</label>
                    <div class="input-group">
                        <input type="number" class="form-control" id="efficiency" min="1" max="100" step="0.1" value="90" required aria-label="충전 효율 (%)">
                        <span class="input-group-text">%</span>
                    </div>
                    <div id="efficiencyError" class="error text-danger" aria-live="polite"></div>
                </div>
                <div class="mb-3">
                    <label for="startTime" class="form-label">충전 시작 시간 :</label>
                    <input type="time" class="form-control" id="startTime" value="04:00" required aria-label="충전 시작 시간 (HH:MM)">
                    <div id="startTimeError" class="error text-body-secondary" aria-live="polite"></div>
                </div>
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="useCurrentTime" checked>
                    <label class="form-check-label" for="useCurrentTime">
                        현재 시간 사용
                    </label>
                </div>
            </div>
        </div>

        <div class="text-center">
            <button class="btn btn-primary me-2" id="calculateBtn"><i class="bi bi-calculator me-1"></i> 계산</button>
            <button class="btn btn-secondary" id="resetBtn"><i class="bi bi-arrow-counterclockwise me-1"></i> 초기화</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // DOM 요소 캐싱
        const elements = {
            batteryCapacity: document.getElementById("batteryCapacity"),
            remainPercent: document.getElementById("remainPercent"),
            remainKWh: document.getElementById("remainKWh"),
            targetPercent: document.getElementById("targetPercent"),
            targetKWh: document.getElementById("targetKWh"),
            chargeSpeed: document.getElementById("chargeSpeed"),
            efficiency: document.getElementById("efficiency"),
            startTime: document.getElementById("startTime"),
            useCurrentTime: document.getElementById("useCurrentTime"),
            estimatedTime: document.getElementById("estimatedTime"),
            endTime: document.getElementById("endTime"),
            remainingUntilEndTime: document.getElementById("remainingUntilEndTime"),
            chargeProgress: document.getElementById("chargeProgress"),
            batteryCapacityError: document.getElementById("batteryCapacityError"),
            remainError: document.getElementById("remainError"),
            targetError: document.getElementById("targetError"),
            chargeSpeedError: document.getElementById("chargeSpeedError"),
            efficiencyError: document.getElementById("efficiencyError"),
            startTimeError: document.getElementById("startTimeError"),
            calculateBtn: document.getElementById("calculateBtn"),
            resetBtn: document.getElementById("resetBtn")
        };

        let isUpdating = false;
        let countdownInterval = null;
        let calculatedEndDate = null;

        // 디바운스 함수
        function debounce(fn, ms) {
            let timeout;
            return (...args) => {
                clearTimeout(timeout);
                timeout = setTimeout(() => fn(...args), ms);
            };
        }

        // 배터리 용량 가져오기
        function getBatteryCapacity() {
            const capacity = parseFloat(elements.batteryCapacity.value);
            return (!isNaN(capacity) && capacity > 0) ? capacity : 0;
        }

        // 입력 유효성 검사
        function validateInputs() {
            let isValid = true;
            Object.values(elements).forEach(el => {
                if (el.id.includes("Error")) el.innerText = "";
            });
            if (elements.startTimeError.classList.contains('text-danger')) {
                elements.startTimeError.classList.remove("text-danger");
                elements.startTimeError.classList.add("text-body-secondary");
            }

            const capacity = parseFloat(elements.batteryCapacity.value);
            const remainKWh = parseFloat(elements.remainKWh.value);
            const targetKWh = parseFloat(elements.targetKWh.value);
            const speed = parseFloat(elements.chargeSpeed.value);
            const efficiency = parseFloat(elements.efficiency.value);
            const startTime = elements.startTime.value;
            const remainPercent = parseFloat(elements.remainPercent.value);
            const targetPercent = parseFloat(elements.targetPercent.value);

            if (elements.batteryCapacity.value && (isNaN(capacity) || capacity <= 0)) {
                elements.batteryCapacityError.innerText = "배터리 용량은 0보다 커야 합니다.";
                isValid = false;
            }
            if (elements.chargeSpeed.value && (isNaN(speed) || speed <= 0)) {
                elements.chargeSpeedError.innerText = "충전 속도는 0보다 커야 합니다.";
                isValid = false;
            }
            if (elements.efficiency.value && (isNaN(efficiency) || efficiency <= 0 || efficiency > 100)) {
                elements.efficiencyError.innerText = "충전 효율은 1~100% 사이여야 합니다.";
                isValid = false;
            }
            if (elements.remainKWh.value && (isNaN(remainKWh) || remainKWh < 0 || (capacity > 0 && remainKWh > capacity))) {
                elements.remainError.innerText = "남은 용량(kWh)은 0과 배터리 용량 사이여야 합니다.";
                isValid = false;
            } else if (elements.remainPercent.value && (isNaN(remainPercent) || remainPercent < 0 || remainPercent > 100)) {
                elements.remainError.innerText = "남은 용량(%)은 0~100 사이여야 합니다.";
                isValid = false;
            }
            if (elements.targetKWh.value && (isNaN(targetKWh) || targetKWh < 0 || (capacity > 0 && targetKWh > capacity))) {
                elements.targetError.innerText = "목표 용량(kWh)은 0과 배터리 용량 사이여야 합니다.";
                isValid = false;
            } else if (elements.targetPercent.value && (isNaN(targetPercent) || targetPercent < 0 || targetPercent > 100)) {
                elements.targetError.innerText = "목표 용량(%)은 0~100 사이여야 합니다.";
                isValid = false;
            }
            if (!isNaN(remainKWh) && !isNaN(targetKWh) && remainKWh >= targetKWh && (elements.remainKWh.value || elements.targetKWh.value)) {
                elements.targetError.innerText = "충전 목표 용량은 남은 용량보다 커야 합니다.";
                isValid = false;
            }
            if (startTime && !/^\d{2}:\d{2}$/.test(startTime)) {
                elements.startTimeError.innerText = "유효한 시간 형식(HH:MM)을 입력하세요.";
                elements.startTimeError.classList.add("text-danger");
                elements.startTimeError.classList.remove("text-body-secondary");
                isValid = false;
            }

            return isValid;
        }

        // %와 kWh 변환
        function percentToKWh(percent) {
            const cap = getBatteryCapacity();
            return (!isNaN(percent) && percent >= 0 && percent <= 100 && cap > 0) ? (cap * percent / 100).toFixed(2) : '';
        }
        function kWhToPercent(kwh) {
            const cap = getBatteryCapacity();
            return (!isNaN(kwh) && kwh >= 0 && cap > 0 && kwh <= cap) ? (kwh / cap * 100).toFixed(2) : '';
        }

        // 값 동기화 및 시간 업데이트
        function updateValueAndTime(sourceInput, targetInput, calculateFunc) {
            if (isUpdating) return;
            isUpdating = true;

            const sourceValue = parseFloat(sourceInput.value);
            targetInput.value = calculateFunc(sourceValue);
            validateInputs();
            updateTime();

            isUpdating = false;
        }

        // 입력 처리 함수
        function updateRemainFromPercent() { updateValueAndTime(elements.remainPercent, elements.remainKWh, percentToKWh); }
        function updateRemainFromKWh() { updateValueAndTime(elements.remainKWh, elements.remainPercent, kWhToPercent); }
        function updateTargetFromPercent() { updateValueAndTime(elements.targetPercent, elements.targetKWh, percentToKWh); }
        function updateTargetFromKWh() { updateValueAndTime(elements.targetKWh, elements.targetPercent, kWhToPercent); }

        // 진행 바 업데이트
        function updateProgress() {
            const remainKWh = parseFloat(elements.remainKWh.value);
            const capacity = getBatteryCapacity();
            const progress = capacity > 0 ? (remainKWh / capacity * 100).toFixed(2) : 0;
            elements.chargeProgress.style.width = `${progress}%`;
            elements.chargeProgress.setAttribute('aria-valuenow', progress);
        }

        // 남은 시간 카운트다운 업데이트
        function updateCountdown() {
            if (!calculatedEndDate || isNaN(calculatedEndDate.getTime())) {
                elements.remainingUntilEndTime.textContent = '-';
                if (countdownInterval) {
                    cancelAnimationFrame(countdownInterval);
                    clearTimeout(countdownInterval);
                    countdownInterval = null;
                }
                return;
            }

            const now = new Date();
            const diffMs = calculatedEndDate.getTime() - now.getTime();

            // 디버깅: 시간 차이 로그
            console.log(`현재 시간: ${now}, 완료 시간: ${calculatedEndDate}, 차이(ms): ${diffMs}`);

            if (diffMs <= 0) {
                elements.remainingUntilEndTime.textContent = '완료됨';
                if (countdownInterval) {
                    cancelAnimationFrame(countdownInterval);
                    clearTimeout(countdownInterval);
                    countdownInterval = null;
                }
                return;
            }

            const totalSeconds = Math.ceil(diffMs / 1000);
            const days = Math.floor(totalSeconds / (3600 * 24));
            const hours = Math.floor((totalSeconds % (3600 * 24)) / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            let display = [];
            if (days > 0) display.push(`${days}일`);
            if (hours > 0 || days > 0) display.push(`${hours}시간`);
            if (minutes > 0 || hours > 0 || days > 0) display.push(`${minutes}분`);
            if (days === 0 && hours === 0 && minutes === 0) display.push(`${seconds}초`);

            elements.remainingUntilEndTime.textContent = display.join(' ') || '곧 완료';

            if (countdownInterval) {
                cancelAnimationFrame(countdownInterval);
                clearTimeout(countdownInterval);
                countdownInterval = null;
            }

            if (totalSeconds <= 60) {
                countdownInterval = requestAnimationFrame(updateCountdown);
            } else {
                const secondsUntilNextMinute = seconds === 0 ? 60 : seconds;
                const timeoutMs = (60 - secondsUntilNextMinute) * 1000;
                countdownInterval = setTimeout(updateCountdown, timeoutMs);
            }
        }

        // 시간 계산 및 표시
        function updateTime() {
            elements.estimatedTime.textContent = '-';
            elements.endTime.textContent = '-';
            elements.remainingUntilEndTime.textContent = '-';
            calculatedEndDate = null;
            if (countdownInterval) {
                cancelAnimationFrame(countdownInterval);
                clearTimeout(countdownInterval);
                countdownInterval = null;
            }

            if (!validateInputs()) {
                updateProgress();
                return;
            }

            const targetKWhVal = parseFloat(elements.targetKWh.value);
            const remainKWhVal = parseFloat(elements.remainKWh.value);
            const speed = parseFloat(elements.chargeSpeed.value);
            const efficiency = parseFloat(elements.efficiency.value) / 100;
            const startTime = elements.startTime.value;

            if (isNaN(targetKWhVal) || isNaN(remainKWhVal) || isNaN(speed) || speed <= 0 || isNaN(efficiency) || targetKWhVal <= remainKWhVal) {
                if (!startTime && !isNaN(targetKWhVal) && !isNaN(remainKWhVal) && !isNaN(speed) && speed > 0 && targetKWhVal > remainKWhVal) {
                    elements.startTimeError.innerText = "시작 시간을 입력하면 완료 시간이 계산됩니다.";
                    elements.startTimeError.classList.remove("text-danger");
                    elements.startTimeError.classList.add("text-body-secondary");
                }
                updateProgress();
                return;
            }

            const neededEnergy = targetKWhVal - remainKWhVal;
            const timeInHours = neededEnergy / (speed * efficiency);
            const totalMinutesDuration = Math.ceil(timeInHours * 60);

            if (totalMinutesDuration >= 0) {
                const hours = Math.floor(totalMinutesDuration / 60);
                const minutes = totalMinutesDuration % 60;
                elements.estimatedTime.textContent = hours > 0 ? `${hours}시간 ${minutes}분` : `${minutes}분`;

                if (startTime && /^\d{2}:\d{2}$/.test(startTime)) {
                    try {
                        const [startHour, startMinute] = startTime.split(':').map(Number);
                        if (startHour < 0 || startHour > 23 || startMinute < 0 || startMinute > 59) throw new Error("Invalid time");

                        const now = new Date();
                        const startDate = new Date(now);
                        startDate.setHours(startHour, startMinute, 0, 0);

                        // 과거 시간 처리: 현재 시간 사용 체크박스가 꺼져 있으면 현재 날짜로 유지
                        if (startDate.getTime() < now.getTime() - 60000 && elements.useCurrentTime.checked) {
                            startDate.setDate(startDate.getDate() + 1);
                            console.log(`시작 시간 과거로 감지, 다음 날로 설정: ${startDate}`);
                        }

                        calculatedEndDate = new Date(startDate.getTime() + totalMinutesDuration * 60 * 1000);

                        // 완료 시간이 현재 시간보다 과거라면 경고
                        if (calculatedEndDate.getTime() < now.getTime()) {
                            elements.startTimeError.innerText = "완료 시간이 현재 시간보다 과거입니다. 시작 시간을 확인하세요.";
                            elements.startTimeError.classList.add("text-danger");
                            elements.startTimeError.classList.remove("text-body-secondary");
                            elements.endTime.textContent = '-';
                            elements.remainingUntilEndTime.textContent = '-';
                            calculatedEndDate = null;
                            return;
                        }

                        const daysDiff = Math.floor((calculatedEndDate - startDate) / (1000 * 60 * 60 * 24));
                        let dayIndicator = "";
                        if (daysDiff > 0) {
                            const days = ["일", "월", "화", "수", "목", "금", "토"];
                            dayIndicator = ` (+${daysDiff}일, ${days[calculatedEndDate.getDay()]}요일)`;
                        }

                        elements.endTime.textContent = calculatedEndDate.toLocaleTimeString('ko-KR', {
                            hour: '2-digit',
                            minute: '2-digit'
                        }) + dayIndicator;

                        elements.startTimeError.innerText = "";
                        elements.startTimeError.classList.remove("text-danger");
                        elements.startTimeError.classList.add("text-body-secondary");

                        updateCountdown();
                    } catch (e) {
                        console.error("Error calculating end time:", e);
                        elements.startTimeError.innerText = "완료 시간 계산 중 오류 발생.";
                        elements.startTimeError.classList.add("text-danger");
                        elements.startTimeError.classList.remove("text-body-secondary");
                        elements.endTime.textContent = '-';
                        elements.remainingUntilEndTime.textContent = '-';
                        calculatedEndDate = null;
                        if (countdownInterval) {
                            cancelAnimationFrame(countdownInterval);
                            clearTimeout(countdownInterval);
                            countdownInterval = null;
                        }
                    }
                } else {
                    elements.endTime.textContent = '-';
                    elements.remainingUntilEndTime.textContent = '-';
                    calculatedEndDate = null;
                    if (countdownInterval) {
                        cancelAnimationFrame(countdownInterval);
                        clearTimeout(countdownInterval);
                        countdownInterval = null;
                    }
                    if (!startTime && !elements.startTimeError.classList.contains('text-danger')) {
                        elements.startTimeError.innerText = "시작 시간을 입력하면 완료 시간이 계산됩니다.";
                        elements.startTimeError.classList.remove("text-danger");
                        elements.startTimeError.classList.add("text-body-secondary");
                    }
                }
            } else {
                elements.estimatedTime.textContent = '0분';
                elements.endTime.textContent = '-';
                elements.remainingUntilEndTime.textContent = '-';
                calculatedEndDate = null;
                if (countdownInterval) {
                    cancelAnimationFrame(countdownInterval);
                    clearTimeout(countdownInterval);
                    countdownInterval = null;
                }
            }
            updateProgress();
        }

        // 전체 업데이트
        function updateAll() {
            const cap = getBatteryCapacity();

            if (elements.remainPercent.value !== '') {
                const remainPercent = parseFloat(elements.remainPercent.value);
                if (!isNaN(remainPercent) && remainPercent >= 0 && remainPercent <= 100 && cap > 0) {
                    elements.remainKWh.value = (cap * remainPercent / 100).toFixed(2);
                } else if (elements.remainPercent.value === '') {
                    if (cap > 0) elements.remainKWh.value = '';
                }
            } else if (elements.remainKWh.value !== '') {
                const kwh = parseFloat(elements.remainKWh.value);
                elements.remainPercent.value = kWhToPercent(kwh);
            }

            if (elements.targetPercent.value !== '') {
                const targetPercent = parseFloat(elements.targetPercent.value);
                if (!isNaN(targetPercent) && targetPercent >= 0 && targetPercent <= 100 && cap > 0) {
                    elements.targetKWh.value = (cap * targetPercent / 100).toFixed(2);
                } else if (elements.targetPercent.value === '') {
                    if (cap > 0) elements.targetKWh.value = '';
                }
            } else if (elements.targetKWh.value !== '') {
                const kwh = parseFloat(elements.targetKWh.value);
                elements.targetPercent.value = kWhToPercent(kwh);
            }

            validateInputs();
            updateTime();
        }

        // 초기화
        function resetForm() {
            elements.batteryCapacity.value = "84";
            elements.remainPercent.value = "";
            elements.remainKWh.value = "";
            elements.targetPercent.value = "";
            elements.targetKWh.value = "";
            elements.chargeSpeed.value = "";
            elements.efficiency.value = "90";
            elements.startTime.value = "";
            elements.useCurrentTime.checked = true;
            updateAll();
        }

        // 이벤트 리스너
        elements.batteryCapacity.addEventListener('input', debounce(updateAll, 300));
        elements.remainPercent.addEventListener('input', debounce(updateRemainFromPercent, 300));
        elements.remainKWh.addEventListener('input', debounce(updateRemainFromKWh, 300));
        elements.targetPercent.addEventListener('input', debounce(updateTargetFromPercent, 300));
        elements.targetKWh.addEventListener('input', debounce(updateTargetFromKWh, 300));
        elements.chargeSpeed.addEventListener('input', debounce(updateTime, 300));
        elements.efficiency.addEventListener('input', debounce(updateTime, 300));
        elements.startTime.addEventListener('input', updateTime);
        elements.useCurrentTime.addEventListener('change', () => {
            if (elements.useCurrentTime.checked) {
                const now = new Date();
                elements.startTime.value = now.toLocaleTimeString('ko-KR', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                });
                updateTime();
            }
        });
        elements.calculateBtn.addEventListener('click', updateTime);
        elements.resetBtn.addEventListener('click', resetForm);

        // 초기 로드
        window.onload = () => {
            if (elements.useCurrentTime.checked) {
                const now = new Date();
                elements.startTime.value = now.toLocaleTimeString('ko-KR', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                });
            }
            updateAll();
        };
    </script>
</body>
</html>
